var documentBody=$(document.body);var documentHTML=$("html");var fixedHeights=!documentBody.hasClass("flex-heights");var posts=$("#posts");var modalOverlay=$("#modal-overlay");var modalArticle=$("#modal-overlay article");var modalPost=$("#modal-overlay article .post");var modalMeta=$("#modal-overlay article .meta ul");var wrapper=$("#wrapper");var headerWrap=$("#header-wrapper");var feedsWrap=$("#feeds-wrapper");var titleHeight=$("#blog-title").outerHeight();var feeds=$("#feeds");var mu=$.browser;var isMobile=documentHTML.hasClass("touch");var backgroundCover=documentBody.hasClass("bgcover");var windowHeight=$(window).height();var easeUp="easeOutBack";var scrollPosition=documentBody.scrollTop()?documentBody.scrollTop():documentHTML.scrollTop();var i;var photos;var IE8=documentHTML.hasClass("lt-ie9");var modalIsOpening=false;var currentURL=document.URL;if($.browser.chrome){documentBody.addClass("chrome")}Array.min=function(a){return Math.min.apply(Math,a)};$.fn.pinterest=function(){var h=$(this);var e=h.find(".share-pinterest");var j=h.find(".share-pinterest").attr("href");var a="";if(h.hasClass("type-photo")){a=h.find(".pxu-photo img").attr("src");c(a)}else{if(h.hasClass("type-photoset")){a=h.find(".pxu-photo:first img").attr("src");c(a)}else{if(h.hasClass("type-text")||h.hasClass("type-chat")||h.hasClass("type-quote")||h.hasClass("type-answer")||h.hasClass("type-link")){a=h.find(":not(#comments) img:first");if(a.parents("#comments")||a===undefined){g()}else{a=a.attr("src");c(a)}}else{if(h.hasClass("type-video")){var d=h.find(".video iframe").attr("src");if(d.indexOf("youtu")!=-1){var f=d.match(/embed\/([a-zA-Z0-9]*)\?/);if(f!==null){a="http://img.youtube.com/vi/"+f[1]+"/maxresdefault.jpg";c(a)}}else{if(d.indexOf("vimeo")!=-1){var b=d.match(/video\/([a-zA-Z0-9]*)/);$.ajax({type:"GET",url:"http://vimeo.com/api/v2/video/"+b[1]+".json",jsonp:"callback",dataType:"jsonp",success:function(k){var l=k[0].thumbnail_large;a=l;c(a)}})}}}else{if(h.hasClass("type-audio")){if(h.find(".album-art").length>0){a=h.find(".album").css("background-image").replace(/"/g,"").replace(/url\(|\)$/ig,"");c(a)}else{g()}}}}}}function c(l){var k=j+l;e.attr("href",k);e.addClass("appended")}function g(){e.addClass("disabled").attr("href","javascript:void(0)")}};var fixHeader=function(a,b,c){if(c>a){headerWrap.addClass("fixed").css({marginTop:-a});wrapper.css({paddingTop:80+a});modalOverlay.css({top:60});feedsWrap.addClass("fixed-feeds")}else{headerWrap.removeClass("fixed").css({marginTop:0});wrapper.css({paddingTop:10});modalOverlay.css({top:(b-c)});feedsWrap.removeClass("fixed-feeds")}};var tweetsList=$("#tweets");var twitterFeed=function(){return $.ajax({url:"https://api.twitter.com/1/statuses/user_timeline.json?screen_name="+twitterUser+"&count=2&callback=?&include_rts=true",dataType:"jsonp",success:function(a){var b=a;$.each(b,function(k){var g=this.id_str;var f=linkifyTweet(this.text);var j=relativeTime(this.created_at);var h="http://twitter.com/"+twitterUser+"/status/"+g;var c="";var e;if(k===0){e='<span class="next-tweet"></span>';c="active"}else{e='<span class="prev-tweet"></span>'}var d='<div class="tweet '+c+'"><p>'+f+'</p> <aside class="tweet-meta"><p><a class="time-ago" href="'+h+'" time="'+this.created_at+'" target="_blank">'+j+'</a> <a class="reply" href="https://twitter.com/intent/tweet?in_reply_to='+g+'" target="_blank" title="Reply to Tweet"></a> <a class="retweet" href="https://twitter.com/intent/retweet?tweet_id='+g+'" target="_blank" title="Retweet"></a> <a class="fav" href="https://twitter.com/intent/favorite?tweet_id='+g+'" target="_blank" title="Favorite Tweet"></a></p></aside>'+e+"</div>";tweetsList.append(d)})},error:function(){tweetsList.append("<p>Twitter&rsquo;s API service is experiencing some technical difficulties. Please try again later.</p>");moreTwitter.css("display","none")}})};var flickrPage=0;var flickrFeed=function(){flickrPage++;return $.ajax({type:"GET",dataType:"json",cache:false,timeout:10000,url:"http://api.flickr.com/services/rest/?&method=flickr.people.getPublicPhotos&api_key=12a49355728ae8a0baa555cb07bcb767&user_id="+flickrID+"&per_page=20&page="+flickrPage+"&extras=url_m,url_n,url_z,url_c,date_taken&format=json&jsoncallback=?",success:function(a){var b=$("#flickr-photos");if(a.stat=="fail"){$("#flickr .next-panel").hide();b.width("100%").html('<div class="error-message"><p>There was a problem returning your Flickr feed. Please double-check your entered credentials.</p> <p>If you\'re having trouble finding your Flickr user ID, try out <a href="http://idgettr.com/">idGettr</a>.</p>')}var c;if(b.width()===0){c=0}else{c=b.width()}$.each(a.photos.photo,function(){var h;var e;var f;var d="http://www.flickr.com/photos/"+flickrID+"/"+this.id;if("url_n" in this){h=this.url_n;e=this.width_n;f=this.height_n}else{if("url_m" in this){h=this.url_m;e=this.width_m;f=this.height_m}else{if("url_c" in this){h=this.url_c;e=this.width_c;f=this.height_c}else{if("url_z" in this){h=this.url_z;e=this.width_z;f=this.height_z}}}}var g='<div class="flickr-photo hidden photo-'+this.id+'"><a href="'+d+'"><img width="'+e+'" height="'+f+'" src="'+h+'"></a></div>';b.append(g);coverImage($(".photo-"+this.id+" img"));c+=236});b.width(c);b.imagesLoaded(function(){$(this).find(".flickr-photo").removeClass("hidden");if(a.photos.photo.length===0){b.data("next-page","stop");$("#flickr .next-panel").addClass("hidden")}else{$("#flickr .next-panel").removeClass("loading")}})},error:function(){}})};var instagramPage=0;function instagramFeed(b){instagramPage++;var a;if(b===undefined){a="https://api.instagram.com/v1/users/self/media/recent?access_token="+instaToken+"&count=20"}else{a=b}$.ajax({type:"GET",dataType:"jsonp",cache:false,timeout:10000,url:a,success:function(h){var l=$("#instagram-photos");if(h.meta.error_type=="OAuthAccessTokenException"){l.width("100%").html('<div class="error-message">'+h.meta.error_message+"</div>");$("#instagram .next-panel").hide()}photos=h.data;var q;if(l.width()===0){q=0}else{q=l.width()}for(i=0;i<photos.length;i++){var d=photos[i];var j=d.images.low_resolution.url;var f=d.images.low_resolution.width;var o=d.images.low_resolution.height;var k=d.id;var s=d.link;var e=d.likes.count;var m=d.comments.count;var g;if(d.caption!==null){g='<p class="caption">'+d.caption.text+"</p>"}else{g=""}var c;if(e==1){c=e+" like"}else{c=e+" likes"}var r;if(m==1){r=m+" comment"}else{r=m+" comments"}var p='<img width="'+f+'" height="'+o+'" src="'+j+'" />';var n='<div class="instagram-photo '+k+'">'+p+'<aside><p><span class="insta-likes">'+c+'</span><span class="insta-comments">'+r+"</span></p>"+g+"</aside></div>";l.append(n);coverImage($(".instagram-photo."+k+" img"));q+=236;if(s!==null){s='<a href="'+s+'" />';$("."+k).find(".insta-likes").wrapInner(s);$("."+k).find(".insta-comments").wrapInner(s);$("."+k).find(".caption").wrapInner(s)}}l.width(q).imagesLoaded(function(){$(".instagram-photo").css({display:"block"}).animate({opacity:1});$("#instagram .next-panel").removeClass("loading");var u="next_url" in h.pagination;if(u){var t=h.pagination.next_url;l.data("next-page",t)}else{l.data("next-page","stop")}})},error:function(){instagramPhotos.width("100%").html('<div class="error-message"><p>Instagram&rsquo;s API service is experiencing some technical difficulties. Please try again later.</p></div>');$("#instagram .next-panel").hide()}})}var likesPanel=function(){var a=$("#likes");if(!a.length){$(".likes-main-wrap, #likes-main-wrap").remove();return}a.on("hover",".like_post",function(f){if(f.type=="mouseenter"){$(this).find(".post_info_top").fadeIn("fast")}else{$(this).find(".post_info_top").fadeOut("fast")}});var e=a.find(".like_photo, .like_video img");e.imagesLoaded(function(){e.each(function(){coverImage($(this))})});var c=0;var d=a.find(".like_post");d.each(function(){c+=236});a.width(c-20);if(a.width()==$("#likes-wrap").width()){var b=$("#likes-wrap").attr("data-likesURL");$("#likes-main-wrap .next-panel").addClass("likes-link").html('<a target="_blank" href="'+b+'"></a>')}};var launchPlayer=function(m,j,g,e,h){var k=m||"";var d=j?'<p class="track-artist">'+j+"</p>":"";var b=g?'<p class="track-title">'+g+"</p>":"";var a=e?'<p class="track-album">'+e+"</p>":"";var c=h||"http://static.tumblr.com/hugxd2w/FEGmb0xyq/album-art-default.jpg";var f;var l=$("#fixed-player");if(l.length){var n=b+d+a;l.find(".track-info").html(n);l.find(".audio-player .player-container div").html(k);if(c.indexOf("album-art-default")!=-1){l.find(".audio-player").removeClass("bgcover")}else{l.find(".audio-player").addClass("bgcover")}l.find(".audio-player").css("background-image","url("+c+")");if(IE8){l.find(".audio-player").css("background-size","cover")}}else{if(c.indexOf("album-art-default")!=-1){f="audio-player"}else{f="audio-player bgcover"}var o='<div id="fixed-player"><div class="'+f+'" style="background-image: url('+c+');"><div class="player-container"><div>'+k+'</div></div></div><div class="track-info">'+b+d+a+'</div><span class="minimize">Minimize</span><span class="close">Close</span></div>';documentBody.append(o);if(IE8){$("#fixed-player .audio-player.bgcover").css("background-size","cover")}}l.animate({bottom:20},easeUp);$("#fixed-player").find(".track-title, .track-artist, .track-album").jOverscroll({scrollTime:1500});if(IE8){l.find(".audio-player").css("background-image","url("+c+")")}};var setupHeader=function(){if(profileEnabled&&twitterEnabled){twitterFeed();!function(e,a,f){var c,b=e.getElementsByTagName(a)[0];if(!e.getElementById(f)){c=e.createElement(a);c.id=f;c.src="//platform.twitter.com/widgets.js";b.parentNode.insertBefore(c,b)}}(document,"script","twitter-wjs")}if(flickrEnabled){flickrFeed()}if(instagramEnabled){instagramFeed()}};var topOfPage;var headerPanel=function(b){var c=$("#feeds #"+b);var a=c.outerHeight();var d=$("#feeds > div.active");if(c.hasClass("active")){feeds.animate({height:0},function(){c.css("visibility","hidden").css("top","50px").removeClass("active");feeds.find("> div").css({top:"50px"})});$("#feeds-list ."+b).removeClass("open")}else{if(d.length){$("#feeds-list .open").removeClass("open");$("#feeds-list ."+b).addClass("open");feeds.animate({height:a}).data("height",a);c.css("visibility","visible").animate({top:0,opacity:1},function(){$(this).find(".next-panel, .previous-panel").animate({opacity:1})}).addClass("active");d.animate({top:50,opacity:0},function(){$(this).css("visibility","hidden").removeClass("active")}).find(".next-panel, .previous-panel").animate({opacity:0})}else{$("#feeds-list ."+b).addClass("open");feeds.animate({height:a}).data("height",a);c.css("visibility","visible").animate({top:0,opacity:1},function(){$(this).find(".next-panel, .previous-panel").animate({opacity:1})}).addClass("active");feeds.find("> div:not(.active)").css({top:50})}if(scrollPosition<titleHeight){topOfPage=true}else{topOfPage=false}}};var closeFeeds=function(d,e){if(blogTitle&&d<e){var a=headerWrap.outerHeight();var b=feeds.data("height");var c=b-(d*(b/e));if(c>=0){feeds.css({height:c})}}else{feeds.css({height:0});$("#feeds-list").find(".open").removeClass("open");feeds.find("> div").removeClass("active").css({visibility:"hidden",top:50})}};$.fn.positionControls=function(){var f=$(this);var a=f.width();var e=$(this).find("> div");var d=e.width();var b=f.find(".previous-panel");var g=f.find(".next-panel");var c=((a-d)/2)-50;b.css("left",c);g.css("right",c)};var panelSlide=function(a,e){var l=a.find(".previous-panel");var n=a.find(".next-panel");var b;var k;var f;if(a.attr("id")=="likes-main-wrap"){b=$("#likes");k=b.find(".like_post:first-child");f=false}else{if(a.attr("id")=="flickr"){b=$("#flickr-photos");k=b.find(".flickr-photo:first-child");var h=b.data("next-page");if(h=="stop"){f=false}else{f=flickrFeed}}else{if(a.attr("id")=="instagram"){b=$("#instagram-photos");k=b.find(".instagram-photo:first-child");var h=b.data("next-page");if(h=="stop"){f=false}else{f=instagramFeed}}}}b.stop(true,true);var c=a.find("> div").width();var m=b.position();var g=Math.round(m.left);var j;if(e=="right"){j=g-c-20;b.animate({left:j});if((j-c-20)<=-(b.width())){if(f){f(h);n.addClass("loading")}else{if(b.attr("id")=="likes"){var d=$("#likes-wrap").attr("data-likesURL");n.addClass("likes-link").html('<a target="_blank" href="'+d+'"></a>')}else{n.addClass("hidden")}}}l.removeClass("hidden")}else{j=g+c+20;b.animate({left:j});if(j===0){l.addClass("hidden")}n.removeClass("hidden likes-link")}};var getThumbnail=function(c){var a=c.attr("id");var b=c.find(".post");$.ajax({url:"http://api.tumblr.com/v2/blog/"+blogName+".tumblr.com/posts?api_key=jgpUKk5tZzUuMaYwGFM2qPMAu8JcnzPl3HV1Ucf3pjn4HzMIWF&id="+a+"&jsonp=?",dataType:"jsonp",type:"get",success:function(d){$.each(d.response.posts,function(f){var g=this.id;if("thumbnail_url" in this){var h=this.thumbnail_url;var e;if(h.indexOf("vimeo")!=-1){e=h.replace("_200","_640");h=e}b.css("background-image","url("+h+")").addClass("bgcover");if(IE8){b.css("background-size","cover")}}else{b.css({backgroundImage:"url(http://static.tumblr.com/hugxd2w/lbvmbg0jx/video-art-default.png)",backgroundPosition:"center center"})}})}})};var viewJS=function(d){var c=jQuery,b=document.getElementsByTagName("script");var a=c(d).filter(".type-photo, .type-photoset");if(b[b.length-1].src.indexOf("?auto")>-1||true){c().ready(function(){var g=a.find("a.view[href]");var f={};g.each(function(){var h=this.rel;if(h){if(!f[h]){f[h]=[]}f[h].push(this)}else{new View(c(this))}});for(var e in f){new View(c(f[e]))}})}};$.fn.slidingPhotoset=function(){var a=$(this);a.find(".slides").imagesLoaded(function(){$(this).slides({autoHeight:true,effect:"slide, slide",next:"next-slide",prev:"previous-slide",generatePagination:false})})};$.fn.exifData=function(){var h=$(this);var d=h.find(".info");var k;if(h.parent().parent().hasClass("type-photo")){k=h.find(".pxu-photo img")}else{k=h.find(".custom-photo img")}if(k.hasClass("exif-yes")&&k.hasClass("caption-yes")){var j=k.data("camera")||"-";var e=k.data("iso")||"-";var f=k.data("aperture")||"-";var a=k.data("exposure")||"-";var g=k.data("focal")||"-";var c=k.data("caption");var b='<table class="exif"><tr><td class="container-cell"><table><tr><td class="label">Camera</td><td>'+j+'</td></tr><tr><td class="label">ISO</td><td>'+e+'</td></tr><tr><td class="label">Aperture</td><td>'+f+'</td></tr><tr><td class="label">Exposure</td><td>'+a+'</td></tr><tr><td class="label">Focal Length</td><td>'+g+'</td></tr><tr><td colspan=2 class="caption">'+c+"</td></tr></table></td></tr><table>";h.append('<div class="pxu-data">'+b+"</div>");d.css("display","block")}else{if(k.hasClass("exif-yes")){var j=k.data("camera")||"-";var e=k.data("iso")||"-";var f=k.data("aperture")||"-";var a=k.data("exposure")||"-";var g=k.data("focal")||"-";var b='<table class="exif exif-only"><tr><td class="container-cell"><table><tr><td class="label">Camera</td><td>'+j+'</td></tr><tr><td class="label">ISO</td><td>'+e+'</td></tr><tr><td class="label">Aperture</td><td>'+f+'</td></tr><tr><td class="label">Exposure</td><td>'+a+'</td></tr><tr><td class="label">Focal Length</td><td>'+g+"</td></tr></table></td></tr><table>";h.append('<div class="pxu-data">'+b+"</div>");d.css("display","block")}else{if(k.hasClass("caption-yes")){var c=k.data("caption");var b='<table class="exif caption-only"><tr><td class="container-cell"><table><tr><td class="caption">'+c+"</td></tr></table></td></tr><table>";h.append('<div class="pxu-data">'+b+"</div>");d.css("display","block")}else{d.remove()}}}h.on("mouseenter",function(){$(this).find(".icons").css("visibility","visible")}).on("mouseleave",function(){$(this).find(".icons").css("visibility","hidden")})};var tumblrNotesInserted=function(b){var a=$("article").find(".notes li:last");if(!(a.hasClass("more_notes_link_container"))){a.addClass("first-note")}};var fixDate=function(b){var g=b.split("-");var c=g[0];var h=g[1];var f=g[2].split(" ");var e=f[0];var d=[];d[0]="January";d[1]="February";d[2]="March";d[3]="April";d[4]="May";d[5]="June";d[6]="July";d[7]="August";d[8]="September";d[9]="October";d[10]="November";d[11]="December";var a=e+" "+d[h-1]+" "+c;return a};var renderModal=function(r,L,d){$.address.value(d);var C=L.post_url;var J='<li class="date">Published<br><span><a href="'+C+'">'+fixDate(L.date)+"</a></span></li>";modalMeta.append(J);if(postAuthors){var z=$("#"+L.id);var q=z.data("author");var o=z.data("authorurl");var N=z.data("authoravatar");var g='<li class="post-author clearfix"><a href="'+o+'"><img alt="" src="'+N+'"> <span>by '+q+"</span></a></li>";modalMeta.append(g)}if(L.note_count>0){if(L.note_count==1&&langNotes=="Notes"){langNotes="Note"}var s='<li class="note-count"><a href="'+C+'#notes">'+L.note_count+" "+langNotes+"</a></li>";modalMeta.append(s)}if(facebookEnabled){var p='<li class="comments"><a href="'+C+'#comments"><fb:comments-count href="'+C+'"></fb:comments-count> Comments</a></li>';modalMeta.append(p);FB.XFBML.parse()}if("reblogged_from_title" in L){var A=L.reblogged_from_title?L.reblogged_from_title:"Untitled";var n='<li class="original"><a href="'+L.reblogged_from_url+'">'+A+"</a></li> ";modalMeta.append(n)}function y(Q,P,R){if(Q!=="medium"&&Q!=="large"){return Q}}if(L.tags.length>0){var b=L.tags;var k=b.filter(y);if(k.length>0){modalMeta.append('<li class="tags" />');var v=modalMeta.find(".tags");k=k.reverse();for(i=k.length;i--;){var G='<a href="/tagged/'+k[i]+'">'+k[i]+"</a>";v.append(G)}modalMeta.append(v);modalMeta.find(".tags").show()}}var m='<li class="share"><span>'+langShare+'</span><div class="widget"><div class="short-url"><input type="text" readonly="" value="'+C+'"></div><div class="share-links"><a target="_new" href="https://twitter.com/intent/tweet?url='+C+'" class="share-twitter">Twitter</a><a target="_new" href="https://www.facebook.com/sharer.php?u='+C+'" class="share-facebook">Facebook</a><a target="_new" href="http://pinterest.com/pin/create/button/?url='+C+'&media=" class="share-pinterest">Pinterest</a><a target="_new" href="https://plusone.google.com/_/+1/confirm?hl=en&url='+C+'" class="share-google">Google+</a></div></div></li>';modalMeta.append(m);var e='<li class="link"><a href="'+C+'">'+langPermalink+"</a></li>";modalMeta.append(e);modalArticle.addClass("type-"+r);var t;if(r=="text"){if(L.title){modalPost.append('<h1><a href="'+L.post_url+'">'+L.title+"</a></h1>")}modalPost.append(L.body)}else{if(r=="photo"){t=L.photos[0].alt_sizes[0].url;modalPost.append('<div class="photo-data"><div class="pxu-photo"><img alt="" src="'+t+'"></div><div class="icons"><a class="view" href="'+t+'"><span class="zoom">Zoom</span></a></div></div>');if("caption" in L){modalPost.append(L.caption)}var I="link_url" in L?L.link_url:false;if(I){modalPost.find(".pxu-photo img").wrap('<a href="'+I+'" />')}}else{if(r=="photoset"){if(customPhotosets){modalPost.append('<div class="photo-slideshow slides custom-photosets"><div class="slides_container"></div></div>');photos="";L.photos=L.photos.reverse();for(i=L.photos.length;i--;){t=L.photos[i].alt_sizes[0].url;photos+='<div class="photo-slide"><div class="custom-photo"><img alt="" src="'+t+'"></div><div class="icons"><a class="view" rel="post-'+L.id+'" href="'+t+'"><span class="zoom">Zoom</span></a></div></div>'}modalPost.find(".slides_container").html(photos);modalPost.find(".photo-slideshow").append('<span class="previous-slide">Previous</span><span class="next-slide">Next</span>')}else{modalPost.append('<div class="photo-slideshow" data-layout="'+L.photoset_layout+'" />');photos="";L.photos=L.photos.reverse();for(i=L.photos.length;i--;){t=L.photos[i].alt_sizes[0].url;photos+='<div class="photo-data"><div class="pxu-photo"><img alt="" src="'+t+'"></div><div class="icons"><a class="view" rel="post-'+L.id+'" href="'+t+'"><span class="zoom">Zoom</span></a></div></div>'}modalPost.find(".photo-slideshow").html(photos).pxuPhotoset({highRes:false,rounded:false,gutter:"5px",photo:".pxu-photo"})}if("caption" in L){modalPost.append(L.caption)}}else{if(r=="quote"){modalPost.append('<blockquote class="quote">'+L.text+"</blockquote><p>"+L.source+"</p>")}else{if(r=="link"){if(L.title){modalPost.append('<h1><a href="'+L.url+'">'+L.title+"</a></h1>")}else{modalPost.append('<h1><a href="'+L.url+'">'+L.url+"</a></h1>")}if("description" in L){modalPost.append(L.description)}}else{if(r=="chat"){if(L.title){modalPost.append('<h1><a href="'+L.post_url+'">'+L.title+"</a></h1>")}L.dialogue=L.dialogue.reverse();for(i=L.dialogue.length;i--;){var F=L.dialogue[i].label,j=L.dialogue[i].phrase;var K;if(i%2===0||i===0){K="odd"}else{K="even"}var h='<p class="line-'+K+'"><span>'+F+"</span>"+j+"</p>";modalPost.append(h)}}else{if(r=="audio"){if(L.player.indexOf("spotify")!=-1){modalPost.append('<div class="audio-embed">'+L.player+"</div>")}else{var O;if("album_art" in L){O=L.album_art;modalPost.append('<div class="album-art bgcover" style="background-image:url('+O+'); background-repeat:no-repeat;"></div>');if(IE8){modalPost.find(".bgcover").css("background-size","cover")}}else{O="http://static.tumblr.com/hugxd2w/Plgmbg0i7/album-art-default.png";modalPost.append('<div class="album-art" style="background-image:url('+O+'); background-repeat:no-repeat;"></div>')}var a=L.player;var M=a.replace("audio_player.swf","audio_player_black.swf");var u="",x="",c="",l="",f="";if("track_name" in L){u='<h1 class="track-name">'+L.track_name+"</h1>"}if("artist" in L){x='<h2 class="artist">'+L.artist+"</h2>"}if("album" in L){if(L.album.indexOf("[artwork]")!=-1){var w=L.album.split("[artwork]")[1];c='<h2 class="album">'+L.album.split("[artwork]")[0]+"</h2>";if(modalArticle.find(".album-art").length===0){modalPost.append('<div class="album-art bgcover" style="background-image:url('+w+');"></div>');if(IE8){modalPost.find(".bgcover").css("background-size","cover")}}else{modalArticle.find(".album-art").css({backgroundImage:"url("+w+")"});if(IE8){modalArticle.find(".album-art").css("background-size","cover")}}}else{c='<h2 class="album">'+L.album+"</h2>"}}if("plays" in L){l=L.plays+" plays"}modalPost.append('<div class="song-info"><div class="player">'+M+"</div>"+u+x+c+"<p>"+l+f+'</p><span class="launch">Open Audio Player</span></div>');modalArticle.find(".track-name, .artist, .album").jOverscroll({scrollTime:1500})}if("caption" in L){modalPost.append(L.caption)}}else{if(r=="video"){modalPost.append('<div class="video">'+L.player[2].embed_code+"</div>");if("caption" in L){modalPost.append(L.caption)}}else{if(r=="answer"){var E=$("#"+L.id).find("p > span").data("avatar");modalPost.append('<div class="question-asker"><img alt="'+L.asking_name+'s avatar" class="avatar" src="'+E+'"><p><span>'+L.asking_name+'</span> asked:</p></div><div class="question">'+L.question+"</div>"+L.answer);if("asking_url" in L){var H='<a href="'+L.asking_url+'" />';modalPost.find(".question-asker p span").wrapInner(H)}}}}}}}}}}if("source_title" in L){var B=L.source_title;var D=L.source_url;modalPost.append('<p class="content-source">Source: <a href="'+D+'">'+B+"</a></p>")}modalArticle.imagesLoaded(function(){var Q=modalArticle.find("aside").height();var P=modalArticle.find(".post").height();if(P<Q){if(IE8){Q=Q-60}modalArticle.find(".post").css("min-height",Q)}if(modalArticle.hasClass("type-photo")){viewJS(modalArticle);modalArticle.find(".photo-data").exifData()}if(modalArticle.hasClass("type-photoset")){viewJS(modalArticle);modalArticle.find(".photo-slide").exifData();$(".slides").slides({autoHeight:true,effect:"slide, slide",next:"next-slide",prev:"previous-slide",generatePagination:false})}if(modalMeta.height()===modalArticle.height()){modalMeta.find("li:last").css("border-bottom","none")}})};var closeModal=function(){if(IE8){modalArticle.css({marginTop:80,opacity:0});modalOverlay.removeClass("active").hide();modalArticle.find(".post").html("").css({minHeight:0});modalMeta.html("");var a=modalArticle.attr("class").split(" ").map(function(b){return b.indexOf("type-")===-1?b:""});modalArticle.attr("class",a.join(" "));$.address.value("#");documentBody.css("overflow","auto")}else{modalArticle.animate({marginTop:80,opacity:0},function(){modalOverlay.removeClass("active").fadeOut(function(){modalArticle.find(".post").html("").css({minHeight:0});modalMeta.html("");var b=modalArticle.attr("class").split(" ").map(function(c){return c.indexOf("type-")===-1?c:""});modalArticle.attr("class",b.join(" "));$.address.value("#")});documentBody.css("overflow","auto")})}};var modalView=function(c,b){var a=c.parents("article").attr("id");documentBody.css("overflow","hidden");if(IE8){modalOverlay.show().addClass("active");modalArticle.css({marginTop:30,opacity:1})}else{modalOverlay.fadeIn(function(){modalArticle.animate({marginTop:30,opacity:1})}).addClass("active")}$.ajax({url:"http://api.tumblr.com/v2/blog/"+blogName+".tumblr.com/posts?api_key=3bk6YiDDOJxTKSFr33oVaFfHlkerlbEBmXuYzAO5ddfMZa5V7E&id="+a+"&reblog_info=true&jsonp=?",dataType:"jsonp",success:function(e){if(e.meta.status!="200"){modalArticle.html("<p>There was an error loading this post, please try again later.</p>");return;modalIsOpening=false}var d=e.response.posts[0];var f=d.type;if(f=="photo"){if("photoset_layout" in d){renderModal("photoset",d,b);modalIsOpening=false}else{renderModal("photo",d,b);modalIsOpening=false}}else{renderModal(f,d,b);modalIsOpening=false}}})};$.fn.renderPosts=function(b){var a=$(this);viewJS(a);a.each(function(){var h=$(this);if(permalinkPage){$("#page-loader").hide();h.permalinkPosts()}if(fixedHeights&&indexPage){if(h.hasClass("type-photo")||h.hasClass("type-photoset")){var d=h.find(".post img:first-child");var g=d.attr("height");var j=d.attr("width");var c=j/g;if(c<1){if(h.hasClass("medium")){h.height(560)}if(h.hasClass("large")){h.height(760)}}coverImage(d)}}else{if(!fixedHeights&&indexPage){if(h.hasClass("type-photo")||h.hasClass("type-photoset")){var d=h.find(".post img:first-child");h.imagesLoaded(function(){if(d.width("100%").height()<160){d.css({height:160,width:"auto",maxWidth:"none"});var o=d.width();var n=d.parent().width();d.css({marginLeft:-((o-n)/2)})}})}}}if(indexPage){if(h.hasClass("type-audio")){if(h.find(".album").length){var f=h.find(".album").data("album");if(f.indexOf("[artwork]")!=-1){var l=f.split("[artwork]")[1];h.find(".post").css({backgroundImage:"url("+l+")"}).addClass("bgcover")}}}if(h.hasClass("type-video")){getThumbnail(h)}if(h.hasClass("large")){if(h.hasClass("type-photo")||h.hasClass("type-photoset")){var m=h.find(".post img:first");var e=m.data("highres");m.attr("src",e)}}}if(IE8){if(h.hasClass("bgcover")){h.css("background-size","cover")}else{if(h.find(".bgcover").length){var k=h.find(".bgcover");k.css("background-size","cover")}}if(indexPage){h.append('<span class="post-icon"></span><span class="fade-out"></span>')}}})};$.fn.permalinkPosts=function(h){var f=$(this);if(f.hasClass("type-photoset")){if(customPhotosets){f.slidingPhotoset();$(".photo-slide").each(function(){$(this).exifData()})}else{f.find(".photo-slideshow").pxuPhotoset({highRes:false,rounded:false,gutter:"5px",photo:".pxu-photo"})}}var j=$("#posts .tags");j.find("a").each(function(k){if($(this).html()=="medium"||$(this).html()=="large"){$(this).remove()}});if(j.find("a").length===0){j.remove()}else{j.show()}if(f.hasClass("type-audio")){var e=f.find(".album").text();if(e.indexOf("[artwork]")!=-1){var g=e.split("[artwork]")[1];var c=e.split("[artwork]")[0];f.find(".album-art").css({backgroundImage:"url("+g+")"}).addClass("bgcover");f.find(".album").text(c)}f.find(".track-name, .artist, .album").jOverscroll({scrollTime:1500})}if(f.hasClass("type-photo")){$(".photo-data").exifData()}tumblrNotesInserted();var d=f.find("aside").height();var a=f.find(".post").height();if(a<d){f.find(".post").css("min-height",d)}$(".post-pagination span").each(function(){if($(this).find("a").length===0){$(this).addClass("disabled")}});var b=$(".original");if(b.length&&!b.find("a").text()){b.find("a").text("Untitled")}};$(window).load(function(){if(indexPage){if(!Modernizr.mq("only screen and (max-width: 480px)")&&$("#posts article").length>0){posts.masonry({itemSelector:"article",gutterWidth:10,columnWidth:180,isFitWidth:true})}$("#page-loader").hide();posts.animate({opacity:1});posts.infinitescroll({loading:{finishedMsg:"That's all the art I have for you today, sorry.",img:"http://static.tumblr.com/hugxd2w/FQnmbylnq/infinite-scroll-loader.gif",msgText:"hello"},nextSelector:".pagination a.previous",navSelector:".pagination",itemSelector:"#posts article"},function(c){var b=$(c).css({opacity:0});b.filter("article").renderPosts();b.imagesLoaded(function(){b.animate({opacity:1});if(!Modernizr.mq("only screen and (max-width: 480px)")){posts.masonry("appended",b,true)}var d=wrapper.height();if(d<windowHeight){posts.infinitescroll("retrieve")}})});var a=wrapper.height();if(a<windowHeight){posts.infinitescroll("retrieve")}}});$(document).ready(function(){$("#posts article").renderPosts();setupHeader();if(!backgroundCover){$("#bg").remove()}if(indexPage){posts.on("hover","article",function(j){if(j.type=="mouseenter"){$(this).find(".mini-meta").fadeIn("fast")}else{$(this).find(".mini-meta").fadeOut("fast")}})}if(likesEnabled){likesPanel()}if(groupBlog){var h;var c;$("#group-members li").each(function(){h=$(this);c=h.find("span");var j=c.outerWidth();c.css("margin-left",-(j/2))}).on("mouseenter",function(){h=$(this);c=h.find("span");c.stop(true,true);c.animate({top:-30,opacity:1},"fast")}).on("mouseleave",function(){h=$(this);c=h.find("span");c.stop(true,true);c.animate({top:-10,opacity:0},"fast")});if(!$("#group-members").length){$("#about").width("70%");$("#twitter").width("30%")}}feeds.on("click",".next-panel:not(.loading, .likes-link)",function(){var j=$(this).parent();panelSlide(j,"right")}).on("click",".previous-panel",function(){var j=$(this).parent();panelSlide(j,"left")}).on("click",".next-tweet, .prev-tweet",function(){$(".tweet.active").fadeOut("fast",function(){$(".tweet:not(.active)").fadeIn("fast").addClass("active");$(this).removeClass("active")})});if(Modernizr.mq("only screen and (max-width: 860px)")&&isMobile){$("#group-members ul li").find("br").remove()}if(!$("#social-icons ul li").length){$("#social-icons").hide();if(!$("#profile #about #avatar").length&&!$("#profile #about #description").length){$("#feeds-wrapper #profile, #feeds-list .profile").remove()}}$(".icons .info").on("mouseenter",function(){var j=$(this);var k;if(j.find(".pxu-data").length){k=j.find(".pxu-data")}else{k=j.parents(".photo-data, .photo-slide").find(".pxu-data")}k.css("display","block").stop(true,false).animate({opacity:1},200)}).on("mouseleave",function(){var j=$(this);var k;if(j.find(".pxu-data").length){k=j.find(".pxu-data")}else{k=j.parents(".photo-data, .photo-slide").find(".pxu-data")}k.stop(true,false).animate({opacity:0},200,function(){$(this).css("display","none")})});$("#wrapper, #modal-overlay").on("click",".mini-meta",function(k){if(!isMobile&&!modalIsOpening){var j=$(this).find("a").attr("href").match(/\/post\/[0-9]+\/?(.+)?/i)[0];modalView($(this),j);modalIsOpening=true;return false}}).on("click",".share span",function(){var j=$(this);var k=j.next(".widget");if(j.hasClass("open")){j.removeClass("open");k.fadeOut("fast").removeClass("open")}else{j.addClass("open");k.fadeIn("fast").addClass("open")}$(this).parents("article").pinterest()}).on("click",function(j){if(!$(j.target).parents(".share").get(0)){$(".widget").each(function(){if($(this).hasClass("open")){$(this).prev("span").removeClass("open");$(this).fadeOut().removeClass("open")}})}}).on("click",".launch",function(){var l=modalArticle.find(".player").html()||undefined;var j=modalArticle.find(".artist").text()||undefined;var n=modalArticle.find(".track-name").text()||undefined;var k=modalArticle.find(".album").text()||undefined;if(IE8){var m=modalArticle.find(".album-art .fake-cover img").attr("src")||undefined}else{var m=modalArticle.find(".album-art").css("background-image").replace(/"/g,"").replace(/url\(|\)$/ig,"")||undefined}launchPlayer(l,j,n,k,m)});documentBody.on("click","#fixed-player .close",function(){$("#fixed-player").animate({bottom:-120},300,easeUp,function(){$(this).remove()})}).on("click","#fixed-player .minimize",function(){$("#fixed-player").animate({width:80},300,"easeOutBack");$("#fixed-player .track-info").animate({opacity:0,width:0},200,"easeOutBack");$(this).addClass("maximize")}).on("click","#fixed-player .maximize",function(){$("#fixed-player").stop().animate({width:226},300,"easeInBack",function(){$("#fixed-player .track-info").css({width:125}).animate({opacity:1},200)});$(this).removeClass("maximize")});modalOverlay.on("click",function(j){if(modalOverlay.hasClass("active")){if(j.target==this||j.target.id=="close"){closeModal()}}});$(document).keyup(function(j){if(j.keyCode==27&&modalOverlay.hasClass("active")){closeModal()}});$("#feeds-list").on("click","li",function(){var j=$(this).attr("class").split(" ")[0];headerPanel(j)});if($("#feeds-list ul li").length===0&&isMobile){$("#feeds-list").remove()}if(likesEnabled){$(".like_note_post").find("br").remove()}if(!blogTitle){$("#tumblr_controls").css("top","66px")}if(!isMobile){if(blogTitle){var b=headerWrap.outerHeight();fixHeader(titleHeight,b,scrollPosition)}var d=function(j){if(IE8){if(j>400){$("#back-to-top").show()}else{$("#back-to-top").hide()}}else{if(j>400){$("#back-to-top").fadeIn()}else{$("#back-to-top").fadeOut()}}};d();if(indexPage){var e=true;setInterval(function(){e=true},100);setInterval(function(){if(e){posts.removeClass("is-scrolling")}},200)}window.onscroll=function(j){scrollPosition=documentBody.scrollTop()?documentBody.scrollTop():documentHTML.scrollTop();d(scrollPosition);if(blogTitle&&indexPage){fixHeader(titleHeight,b,scrollPosition)}if(indexPage){posts.addClass("is-scrolling");e=false;if(scrollPosition===0){topOfPage=true}if(feeds.find("> .active").length&&topOfPage){closeFeeds(scrollPosition,titleHeight)}}};$("#back-to-top").on("click",function(){$("html,body").animate({scrollTop:0})})}$.address.init(function(j){if(j.value.indexOf("/post/")>=0){window.location=j.value}}).change(function(j){});if(Modernizr.mq("only screen and (min-width: 861px) and (max-width: 1286px)")){$("#flickr,#instagram,#likes-main-wrap").positionControls();window.onresize=function(){$("#flickr,#instagram,#likes-main-wrap").positionControls()}}var g=function(j){if(j<1003){f.css({width:688,margin:"0 auto"});$("#feeds-wrapper #feeds").find(".previous-panel").css("left","10px");$("#feeds-wrapper #feeds").find(".next-panel").css("right","10px")}if(j>1004&&j<1240){f.css({width:924,margin:"0 auto"});$("#feeds-wrapper #feeds").find(".previous-panel").css("left","10px");$("#feeds-wrapper #feeds").find(".next-panel").css("right","10px")}if(j>=1241){f.css({width:1160,margin:"0 auto"});$("#feeds-wrapper #feeds").find(".previous-panel").css("left","-50px");$("#feeds-wrapper #feeds").find(".next-panel").css("right","-50px")}if(j>=1200){$("#feeds-wrapper #feeds #profile, #feeds-wrapper #feeds #group-blog").css({width:"100%",padding:"30px 0"})}};if(IE8){var f=$("#likes-main-wrap > div, #flickr > div, #instagram > div");var a=documentBody.width();g(a);$(window).resize(function(){a=documentBody.width();g(a)});modalOverlay.append('<div class="cleafix">&nbsp;</div>')}if(indexPage&&!isMobile){if(currentURL.indexOf("/search/")!=-1&&currentURL.indexOf("invaders")!=-1&&currentURL.indexOf("space")!=-1&&$("#posts article").length===0){$("#page-loader").hide();documentBody.css("background-image","url(http://static.tumblr.com/hugxd2w/Hg0mbp5md/space-invaders.png)");$(".results").hide();posts.append('<iframe id="space-invaders" src="http://cdn.pixelunion.net/fifth-avenue-fun/space-invaders.html"></iframe>')}}if(currentURL.indexOf("tumblr.com/customize")!=-1){posts.masonry({itemSelector:"article",gutterWidth:10,columnWidth:180,isFitWidth:true})}});
